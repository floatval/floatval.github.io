---
title: C++中的左值和右值
date: 2019-10-05 13:27:00
categories:
  - C++
tags:
  - 语义
  
copyright: true

---
# 基本概念
***
  C++ 中每个表达式均有两种类型： `值类别(values categories)` 和 `类型(type)`  。
  
  作用：
  
   - 值类别：编译器在对表达式进行创建、复制、移动临时对象时必须遵循的规则。
     通俗来说，值类别是用于程序运行时编译器进行语法检查。
   
   - 类型： 编译器在编译阶段用于分配内存的依据、以及确定表达式或变量可以进行的操作。
     通俗来讲，类型是用于编译器在编译器在编译阶段进行类型检查。
     
  可以较为简单的将 **类型** 和 **值类别** 理解为：类型决定了是什么，而值类别绝对了怎么做。
  
  **注意:** 类型和值类别是独立的两种属性，不存在谁依赖于谁。只是在其行为上看来有依赖关系。
  
  左值和右值均属于值类型。
  
<!--more-->
 
***
# C++11 中的值类别
***
  C++ 中值类别分为：泛左值、右值、左值、将亡值、纯右值。不同值类型别间的关系，见下图:
  
  <center>
  ```mermaid
  graph TD
  A[值类型] --> B[glvalue]
  B --> lvalue
  B -->xvalue
  A --> C[rvalue]
  C-->xvalue
  C-->prvalue
  ```
  </center>
## 值类别的定义

以下内容引用自 [cppreference](https://zh.cppreference.com/w/cpp/language/value_category#.E5.8E.86.E5.8F.B2)

> 泛左值 (glvalue)（“泛化 (generalized)”的左值）是其求值确定一个对象、位域或函数的个体的表达式；
  
> 纯右值 (prvalue)（“纯 (pure)”的右值）是求值符合下列之一的表达式：
  计算某个运算符的操作数的值（这种纯右值没有结果对象），或者初始化某个对象或位域
 （称这种纯右值有一个结果对象）。所有类和数组的纯右值都有结果对象，即使它被舍弃也是如此。在某些语境中，将发生临时量实质化，以创建作为其结果对象的临时量；
 
> 亡值 (xvalue)（“将亡 (expiring)”的值）是代表其资源能够被重新使用的对象或位域的泛左值；

> 左值 (lvalue)（如此称呼的历史原因是，左值可以出现于赋值表达式的左边）是非亡值的泛左值；

> 右值 (rvalue)（如此称呼的历史原因是，右值可以出现于赋值表达式的右边）是纯右值或者亡值。

## 区分值类别的方法

  知道什么值类别的作用、不同值类别之间的关系以及什么是值类别后，还需要了解如何区分不同的值类别，才可以进行运用。
  如果从定义上进行值类别的区别，会发现无从下手……定义说的是什么鬼东西，这是正常人能明白的么？？
  
  可以从定义出发，提取出左值和右值的关键特性，进而通过特性来对他们进行区分。
  
### 特性区分

  看要区分的对象能否取地址即可。
  - 左值具有程序可以访问的地址，即 **可以取地址** 为左值
  - 右值不具有程序可以访问的地址(但是却具有映射到物理内存的地址）即 **不可取地址** ，为右值
  
### 定义区分

```C++
    int a = 10; // 左值表达式，求值确定了一个 int 对象 a 
    class B{}; // 内部属性省略
    B c; // 左值表达式 表达式 C 为一个 B 类的实例化对象, 求值初始化了一个对象
    c.name = "a"; // 左值
    c.age = 10; // 左值
    B d;
    d("b", 20); // 左值表达式 求值初始化了对象 d
    func(a) + func(b); // 右值 func 为右值求值确定了 + 运算符的操作数，在表达式中，func 作为操作数
```

总结：从定义上来看，右值表达式，返回的是一个临时变量，其作用域只有使用它的位置（类似匿名表达式)